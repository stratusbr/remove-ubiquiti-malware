#!/bin/bash
#Remove malware of ubiquiti devices
#by Jorge Luiz Taioque
#www.networktips.com.br
#
#Usage:
#./remove-ubiquiti-malware.sh [ip/24] [USERNAME] [PASSWORD]
#Link
#./remove-ubiquiti-malware.sh 192.168.0 ubnt ubnt

IPS=$1
USER=$2
PASS=$3

for i in {1..254} ;do 
echo "ACESSANDO IP $IPS$i";
timeout 10 ./sshpass -p $PASS ssh $IPS$i -l $USER "
if [ -e /etc/persistent/mf.tar ]; then echo \"***EQUIPAMENTO COM VIRUS $IP ***\"; fi
rm -fr /etc/persistent/rc.* /etc/persistent/profile;
rm -rf /etc/persistent/rc.poststart; 
rm -rf rc.poststart; 
rm -rf mf.tar; 
save;
cfgmtd -w -p /etc; 
reboot -f;";

timeout 10 ./sshpass -p fuker ssh $IPS$i -l mother "
if [ -e /etc/persistent/mf.tar ]; then echo \"***EQUIPAMENTO COM VIRUS $IP ***\"; fi
rm -fr /etc/persistent/rc.* /etc/persistent/profile;
rm -rf /etc/persistent/rc.poststart; 
rm -rf rc.poststart; 
rm -rf mf.tar; 
save;
cfgmtd -w -p /etc; 
reboot -f;";

done > resultado-$1.txt
